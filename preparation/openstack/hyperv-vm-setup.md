# 配置Hyper-V Ubuntu Server虚拟机

由于在虚拟机上直接使用带GUI的Ubuntu比较耗资源（开启后内存占用15G+），所以考虑在虚拟机上使用不带GUI的Ubuntu Server，并使用虚拟网卡实现主机和虚拟机的双向通信。

1. 在Hyper-V上安装Ubuntu Server 18.04
   1. 配置：4G内存，4核
   2. 在安装时设置镜像地址为TUNA：`https://mirrors.tuna.tsinghua.edu.cn/ubuntu/`
2. 关机
3. 在Hyper-V上增加一个使用**内部网络**的**虚拟交换机**
4. 在主机上，在`适配器设置`中找到这个交换机，并设置其IP地址为`192.168.1.20`，子网掩码为`255.255.255.0`
5. 给这个虚拟机增加这个虚拟交换机（设置->添加硬件->网络适配器）
6. 开机
7. `sudo vim /etc/netplan`并选择里面仅有的一个文件，在`ethernets`块中增加

```yaml
eth1:
    addresses: [192.168.1.21/24]
```

7. 保存
8. 运行`sudo netplan apply`保存设置
9. 现在可以通过`192.168.1.20`访问主机，`192.168.1.21`访问虚拟机
   1.  可以在**主机**通过`ssh 192.168.1.21` SSH登录到虚拟机进行操作
   2.  可以在**虚拟机**通过设置`192.168.1.20:1080`为HTTP代理，使用主机上运行的SS代理

